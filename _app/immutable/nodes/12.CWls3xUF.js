import{c as Bt,a as y,t as R}from"../chunks/Cbs2TP5J.js";import"../chunks/DppSS1ZK.js";import{ak as Kt,aq as rt,al as Qt,j as e,o as m,c as t,am as a,an as n,ao as i,ap as nt,ar as $,as as D,at as wt}from"../chunks/BQECxIka.js";import{e as w,s as At}from"../chunks/D7dhJHJ5.js";import{i as J}from"../chunks/BxIlQOsl.js";import{e as it,i as vt}from"../chunks/_x8JZXJS.js";import{r as b,s as Vt,a as Wt}from"../chunks/C1JmazWi.js";import{b as A,a as Rt}from"../chunks/BHVgj7FX.js";import{b as jt}from"../chunks/CoqOecze.js";import{p as Zt}from"../chunks/CWmzcjye.js";import{i as te}from"../chunks/-1FsuQLY.js";import{o as ee}from"../chunks/BNi7mzQR.js";import{g as X}from"../chunks/CufRIGZF.js";import{g as G}from"../chunks/puSRjKWt.js";import{a as L}from"../chunks/BMexqwi4.js";import{s as ae}from"../chunks/U1qOr88d.js";var se=R("<p>Loading profile…</p>"),oe=R('<div class="error-banner svelte-1gkgttx"> </div>'),le=R('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),re=R('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),ne=R('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=R('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ve=R('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ce=R('<!> <main class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Hometown</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></main>',1);function je(Tt,qt){Kt(qt,!1);const ct=[];let F=m(""),pt="",ut="",M=m(""),T=m([]),H=m("regular"),U=m("Amateur"),_=m([]),f=m([]),k=m([]),N=m(0),Y=null,B=m(null),I=m(!1),gt=m(!0),S=m(null);ee(async()=>{const{username:v,token:d,profile:l}=X(L);if(!v||!d){G("/login");return}e(B,(l==null?void 0:l.imageSmall)||null),pt=(l==null?void 0:l.image)||"",ut=(l==null?void 0:l.imageSmall)||"";try{const u=await fetch(`/data/profiles/${v}.json`);if(u.ok){const s=await u.json();e(F,s.name),e(M,s.hometown),e(T,s.skater_type),e(H,s.stance||"regular"),e(U,s.status),e(_,s.sponsors||[]),e(f,s.contest_results||[]),e(k,s.social_urls||[])}}catch(u){console.error(u),e(S,"Failed to load profile.")}finally{e(gt,!1)}});async function Ct(v){var P;const d=v.currentTarget;if(!((P=d.files)!=null&&P.length))return;Y=d.files[0],e(B,URL.createObjectURL(Y)),e(I,!0),e(N,0);const{token:l}=X(L),u=new FormData;u.append("file",Y),u.append("useDiffusion","false");const s=new XMLHttpRequest;s.open("POST","https://3ee.dev/account/upload/",!0),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Access-Control-Allow-Origin","https://skatebuild.pro"),s.setRequestHeader("Authorization",`Token ${l}`),s.upload.onprogress=x=>{x.lengthComputable&&e(N,Math.round(x.loaded/x.total*100))},s.onload=()=>{if(e(I,!1),s.status===401){L.set({}),G("/login");return}if(s.status>=200&&s.status<300){const x=JSON.parse(s.responseText),q={...X(L)};q.profile={...q.profile,image:x.image,imageSmall:x.imageSmall},L.set(q)}else console.error("Upload failed",s.statusText),e(S,"Image upload failed")},s.onerror=()=>{e(I,!1),console.error("XHR error"),e(S,"Image upload failed")},s.send(u)}function Ot(){e(_,[...t(_),""])}function Pt(v){e(_,t(_).filter((d,l)=>l!==v))}function Dt(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Lt(v){e(f,t(f).filter((d,l)=>l!==v))}function Ht(){e(k,[...t(k),""])}function Ut(v){e(k,t(k).filter((d,l)=>l!==v))}async function It(){e(S,null);const{username:v,token:d}=X(L);if(!v||!d){e(S,"Not authenticated");return}const l={name:t(F),hometown:t(M),skater_type:t(T),stance:t(H),status:t(U),sponsors:t(_),contest_results:t(f),image:pt,imageSmall:ut,social_urls:t(k)};try{const u=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{Accept:"application/json","Access-Control-Allow-Origin":"https://skatebuild.pro","Content-Type":"application/json",Authorization:`Token ${d}`},mode:"cors",body:JSON.stringify(l)}),s=await u.json();if(ae.set(s),await G("/"),!u.ok)throw new Error(j.detail||"Save failed");G("/")}catch(u){console.error(u),e(S,u.message)}}te();var dt=Bt(),$t=rt(dt);{var Ft=v=>{var d=se();y(v,d)},Mt=v=>{var d=ce(),l=rt(d);{var u=o=>{var r=oe(),c=n(r,!0);i(r),$(()=>At(c,t(S))),y(o,r)};J(l,o=>{t(S)&&o(u)})}var s=a(l,2),P=a(n(s),2),x=n(P),q=a(x,2),Nt=a(q,2);{var zt=o=>{var r=le(),c=rt(r),p=a(c,2),g=n(p);i(p),$(()=>{Wt(c,t(N)),At(g,`Uploading… ${t(N)??""}%`)}),y(o,r)};J(Nt,o=>{t(I)&&o(zt)})}i(P);var K=a(P,2),Q=n(K),mt=a(n(Q),2);b(mt),i(Q);var V=a(Q,2),ft=a(n(V),2);b(ft),i(V);var W=a(V,2),Z=n(W),z=n(Z);b(z),z.value=z.__value="skateboarder",nt(),i(Z);var _t=a(Z,2),E=n(_t);b(E),E.value=E.__value="roller skater",nt(),i(_t),i(W);var kt=a(W,2);{var Et=o=>{var r=re(),c=a(n(r),2);$(()=>{t(H),D(()=>{})});var p=n(c);p.value=p.__value="regular";var g=a(p);g.value=g.__value="goofy",i(c),i(r),jt(c,()=>t(H),h=>e(H,h)),y(o,r)};J(kt,o=>{t(T).includes("skateboarder")&&o(Et)})}var tt=a(kt,2),et=a(n(tt),2);$(()=>{t(U),D(()=>{})});var at=n(et);at.value=at.__value="amateur";var bt=a(at);bt.value=bt.__value="pro",i(et),i(tt);var st=a(tt,2),xt=a(n(st),2);it(xt,1,()=>t(k),vt,(o,r,c)=>{var p=ne(),g=n(p);b(g);var h=a(g,2);i(p),A(g,()=>t(k)[c],C=>wt(k,t(k)[c]=C)),w("click",h,()=>Ut(c)),y(o,p)});var Jt=a(xt,2);i(st);var ot=a(st,2),ht=a(n(ot),2);it(ht,1,()=>t(_),vt,(o,r,c)=>{var p=ie(),g=n(p);b(g);var h=a(g,2);i(p),A(g,()=>t(_)[c],C=>wt(_,t(_)[c]=C)),w("click",h,()=>Pt(c)),y(o,p)});var Xt=a(ht,2);i(ot);var yt=a(ot,2),St=a(n(yt),2);it(St,1,()=>t(f),vt,(o,r,c)=>{var p=ve(),g=n(p);b(g);var h=a(g,2);b(h);var C=a(h,2);b(C);var lt=a(C,2);b(lt);var Yt=a(lt,2);i(p),A(g,()=>t(r).name,O=>(t(r).name=O,D(()=>t(f)))),A(h,()=>t(r).division,O=>(t(r).division=O,D(()=>t(f)))),A(C,()=>t(r).date,O=>(t(r).date=O,D(()=>t(f)))),A(lt,()=>t(r).placement,O=>(t(r).placement=O,D(()=>t(f)))),w("click",Yt,()=>Lt(c)),y(o,p)});var Gt=a(St,2);i(yt),nt(2),i(K),i(s),$(()=>{Vt(x,"src",t(B)||"/default-avatar.png"),q.disabled=t(I)}),w("change",q,Ct),A(mt,()=>t(F),o=>e(F,o)),A(ft,()=>t(M),o=>e(M,o)),Rt(ct,[],z,()=>t(T),o=>e(T,o)),Rt(ct,[],E,()=>t(T),o=>e(T,o)),jt(et,()=>t(U),o=>e(U,o)),w("click",Jt,Ht),w("click",Xt,Ot),w("click",Gt,Dt),w("submit",K,Zt(It)),y(v,d)};J($t,v=>{t(gt)?v(Ft):v(Mt,!1)})}y(Tt,dt),Qt()}export{je as component};
