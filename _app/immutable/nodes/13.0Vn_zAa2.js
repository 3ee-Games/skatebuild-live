import{c as Yt,a as y,t as j}from"../chunks/Doa8wjnW.js";import"../chunks/1NVSwa0V.js";import{am as Bt,ar as rt,an as Kt,j as e,o as m,c as t,ao as a,ap as n,aq as i,al as nt,as as J,at as P,au as yt}from"../chunks/ej_Vdcdl.js";import{e as A,s as wt}from"../chunks/Cz9yb1SE.js";import{i as B}from"../chunks/CILL4GR2.js";import{e as it,i as ct}from"../chunks/BimC9IYY.js";import{r as h,s as Qt,a as Vt}from"../chunks/BqNEn0Gf.js";import{b as R,a as At}from"../chunks/CTMlGoQ_.js";import{b as Rt}from"../chunks/T6lJSeuR.js";import{p as Wt}from"../chunks/CWmzcjye.js";import{i as Zt}from"../chunks/CyOr1GcM.js";import{o as te}from"../chunks/fYNbbKBD.js";import{g as z}from"../chunks/Bu9kb4uT.js";import{g as vt}from"../chunks/B7b2kqBE.js";import{a as D}from"../chunks/CgfUSf79.js";import{s as jt}from"../chunks/GknLpfGC.js";var ee=j("<p>Loading profile…</p>"),ae=j('<div class="error-banner svelte-1gkgttx"> </div>'),se=j('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),oe=j('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),le=j('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),re=j('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ne=j('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=j('<!> <main class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Hometown</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></main>',1);function Ae(Ct,Ot){Bt(Ot,!1);const pt=[];let U=m(""),H="",$="",N=m(""),w=m([]),q=m("regular"),L=m("amateur"),k=m([]),f=m([]),b=m([]),E=m(null),I=m(!1),X=m(0),ut=m(!0),C=m(null);te(async()=>{const s=z(jt);e(U,s.name),e(N,s.hometown),e(w,[...s.skater_type]),e(q,s.stance||"regular"),e(L,s.status||"amateur"),e(k,[...s.sponsors||[]]),e(f,[...s.contest_results||[]]),e(b,[...s.social_urls||[]]),H=s.image,$=s.imageSmall,e(E,s.imageSmall);try{const{username:c,token:d}=z(D);if(!c||!d){vt("/login");return}const _=await fetch(`/data/profiles/${c}.json`);if(_.ok){const l=await _.json();e(U,l.name),e(N,l.hometown),e(w,l.skater_type),e(q,l.stance||"regular"),e(L,l.status.toLowerCase()),e(k,l.sponsors||[]),e(f,l.contest_results||[]),e(b,l.social_urls||[]),H=l.image,$=l.imageSmall,e(E,l.imageSmall)}}catch(c){console.error("Failed to load profile JSON, using draft:",c)}finally{e(ut,!1)}});async function Tt(s){var M;const c=s.currentTarget;if(!((M=c.files)!=null&&M[0]))return;const d=c.files[0];e(E,URL.createObjectURL(d)),e(I,!0),e(X,0);const{token:_}=z(D),l=new FormData;l.append("file",d),l.append("useDiffusion","false");const u=new XMLHttpRequest;u.open("POST","https://3ee.dev/account/upload/",!0),u.setRequestHeader("Accept","application/json"),u.setRequestHeader("Access-Control-Allow-Origin","https://skatebuild.pro"),u.setRequestHeader("Authorization",`Token ${_}`),u.upload.onprogress=x=>{x.lengthComputable&&e(X,Math.round(x.loaded/x.total*100))},u.onload=()=>{if(e(I,!1),u.status===401){D.set({}),vt("/login");return}if(u.status>=200&&u.status<300){const x=JSON.parse(u.responseText);H=x.image,$=x.imageSmall;const F={...z(D)};F.profile={...F.profile,image:H,imageSmall:$},D.set(F)}else console.error("Upload failed:",u.statusText),e(C,"Image upload failed")},u.onerror=()=>{e(I,!1),console.error("Upload XHR error"),e(C,"Image upload failed")},u.send(l)}function qt(){e(k,[...t(k),""])}function Lt(s){e(k,t(k).filter((c,d)=>d!==s))}function Pt(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Dt(s){e(f,t(f).filter((c,d)=>d!==s))}function Ut(){e(b,[...t(b),""])}function Ht(s){e(b,t(b).filter((c,d)=>d!==s))}async function $t(){e(C,null);const{username:s,token:c}=z(D);if(!s||!c){e(C,"Not authenticated");return}const d={name:t(U),hometown:t(N),skater_type:t(w),stance:t(q),status:t(L),sponsors:t(k),contest_results:t(f),image:H,imageSmall:$,social_urls:t(b)};try{const _=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{Accept:"application/json","Access-Control-Allow-Origin":"https://skatebuild.pro","Content-Type":"application/json",Authorization:`Token ${c}`},mode:"cors",body:JSON.stringify(d)}),l=await _.json();if(jt.set(l),!_.ok)throw new Error(l.detail||"Save failed");await vt(`/profiles/${s}`)}catch(_){console.error(_),e(C,_.message)}}Zt();var gt=Yt(),Nt=rt(gt);{var It=s=>{var c=ee();y(s,c)},Mt=s=>{var c=ie(),d=rt(c);{var _=o=>{var r=ae(),v=n(r,!0);i(r),J(()=>wt(v,t(C))),y(o,r)};B(d,o=>{t(C)&&o(_)})}var l=a(d,2),u=a(n(l),2),M=n(u),x=a(M,2),F=a(x,2);{var Ft=o=>{var r=se(),v=rt(r),p=a(v,2),g=n(p);i(p),J(()=>{Vt(v,t(X)),wt(g,`Uploading… ${t(X)??""}%`)}),y(o,r)};B(F,o=>{t(I)&&o(Ft)})}i(u);var K=a(u,2),Q=n(K),dt=a(n(Q),2);h(dt),i(Q);var V=a(Q,2),mt=a(n(V),2);h(mt),i(V);var W=a(V,2),Z=n(W),G=n(Z);h(G),G.value=G.__value="skateboarder",nt(),i(Z);var ft=a(Z,2),Y=n(ft);h(Y),Y.value=Y.__value="roller skater",nt(),i(ft),i(W);var _t=a(W,2);{var Jt=o=>{var r=oe(),v=a(n(r),2);J(()=>{t(q),P(()=>{})});var p=n(v);p.value=p.__value="regular";var g=a(p);g.value=g.__value="goofy",i(v),i(r),Rt(v,()=>t(q),S=>e(q,S)),y(o,r)};B(_t,o=>{t(w).includes("skateboarder")&&o(Jt)})}var tt=a(_t,2),et=a(n(tt),2);J(()=>{t(L),P(()=>{})});var at=n(et);at.value=at.__value="amateur";var kt=a(at);kt.value=kt.__value="pro",i(et),i(tt);var st=a(tt,2),bt=a(n(st),2);it(bt,1,()=>t(b),ct,(o,r,v)=>{var p=le(),g=n(p);h(g);var S=a(g,2);i(p),R(g,()=>t(b)[v],O=>yt(b,t(b)[v]=O)),A("click",S,()=>Ht(v)),y(o,p)});var zt=a(bt,2);i(st);var ot=a(st,2),xt=a(n(ot),2);it(xt,1,()=>t(k),ct,(o,r,v)=>{var p=re(),g=n(p);h(g);var S=a(g,2);i(p),R(g,()=>t(k)[v],O=>yt(k,t(k)[v]=O)),A("click",S,()=>Lt(v)),y(o,p)});var Et=a(xt,2);i(ot);var ht=a(ot,2),St=a(n(ht),2);it(St,1,()=>t(f),ct,(o,r,v)=>{var p=ne(),g=n(p);h(g);var S=a(g,2);h(S);var O=a(S,2);h(O);var lt=a(O,2);h(lt);var Gt=a(lt,2);i(p),R(g,()=>t(r).name,T=>(t(r).name=T,P(()=>t(f)))),R(S,()=>t(r).division,T=>(t(r).division=T,P(()=>t(f)))),R(O,()=>t(r).date,T=>(t(r).date=T,P(()=>t(f)))),R(lt,()=>t(r).placement,T=>(t(r).placement=T,P(()=>t(f)))),A("click",Gt,()=>Dt(v)),y(o,p)});var Xt=a(St,2);i(ht),nt(2),i(K),i(l),J(()=>{Qt(M,"src",t(E)||"/default-avatar.png"),x.disabled=t(I)}),A("change",x,Tt),R(dt,()=>t(U),o=>e(U,o)),R(mt,()=>t(N),o=>e(N,o)),At(pt,[],G,()=>t(w),o=>e(w,o)),At(pt,[],Y,()=>t(w),o=>e(w,o)),Rt(et,()=>t(L),o=>e(L,o)),A("click",zt,Ut),A("click",Et,qt),A("click",Xt,Pt),A("submit",K,Wt($t)),y(s,c)};B(Nt,s=>{t(ut)?s(It):s(Mt,!1)})}y(Ct,gt),Kt()}export{Ae as component};
