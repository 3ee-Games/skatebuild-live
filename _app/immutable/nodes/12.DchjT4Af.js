import{c as Yt,a as y,t as T}from"../chunks/Cbs2TP5J.js";import"../chunks/DppSS1ZK.js";import{ak as Bt,aq as ot,al as Kt,j as e,o as m,c as t,am as a,an as n,ao as i,ap as lt,ar as $,as as C,at as St}from"../chunks/BQECxIka.js";import{e as w,s as wt}from"../chunks/D7dhJHJ5.js";import{i as E}from"../chunks/BxIlQOsl.js";import{e as rt,i as nt}from"../chunks/_x8JZXJS.js";import{r as b,s as Qt,a as Vt}from"../chunks/C1JmazWi.js";import{b as R,a as Rt}from"../chunks/BHVgj7FX.js";import{b as Tt}from"../chunks/CoqOecze.js";import{p as Wt}from"../chunks/CWmzcjye.js";import{i as Zt}from"../chunks/-1FsuQLY.js";import{o as te}from"../chunks/BNi7mzQR.js";import{g as J}from"../chunks/CufRIGZF.js";import{g as it}from"../chunks/Da9vBApV.js";import{a as D}from"../chunks/BMexqwi4.js";var ee=T("<p>Loading profile…</p>"),ae=T('<div class="error-banner svelte-1gkgttx"> </div>'),se=T('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),oe=T('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),le=T('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),re=T('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ne=T('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=T('<!> <main class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Hometown</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></main>',1);function we(jt,At){Bt(At,!1);const vt=[];let F=m(""),ct="",ut="",H=m(""),j=m([]),O=m("regular"),U=m("Amateur"),_=m([]),f=m([]),k=m([]),M=m(0),X=null,G=m(null),I=m(!1),pt=m(!0),S=m(null);te(async()=>{const{username:v,token:d,profile:l}=J(D);if(!v||!d){it("/login");return}e(G,(l==null?void 0:l.imageSmall)||null),ct=(l==null?void 0:l.image)||"",ut=(l==null?void 0:l.imageSmall)||"";try{const p=await fetch(`/data/profiles/${v}.json`);if(p.ok){const o=await p.json();e(F,o.name),e(H,o.hometown),e(j,o.skater_type),e(O,o.stance||"regular"),e(U,o.status),e(_,o.sponsors||[]),e(f,o.contest_results||[]),e(k,o.social_urls||[])}}catch(p){console.error(p),e(S,"Failed to load profile.")}finally{e(pt,!1)}});async function Lt(v){var q;const d=v.currentTarget;if(!((q=d.files)!=null&&q.length))return;X=d.files[0],e(G,URL.createObjectURL(X)),e(I,!0),e(M,0);const{token:l}=J(D),p=new FormData;p.append("file",X),p.append("useDiffusion","false");const o=new XMLHttpRequest;o.open("POST","https://3ee.dev/account/upload/",!0),o.setRequestHeader("Authorization",`Token ${l}`),o.upload.onprogress=x=>{x.lengthComputable&&e(M,Math.round(x.loaded/x.total*100))},o.onload=()=>{if(e(I,!1),o.status===401){D.set({}),it("/login");return}if(o.status>=200&&o.status<300){const x=JSON.parse(o.responseText),A={...J(D)};A.profile={...A.profile,image:x.image,imageSmall:x.imageSmall},D.set(A)}else console.error("Upload failed",o.statusText),e(S,"Image upload failed")},o.onerror=()=>{e(I,!1),console.error("XHR error"),e(S,"Image upload failed")},o.send(p)}function Pt(){e(_,[...t(_),""])}function qt(v){e(_,t(_).filter((d,l)=>l!==v))}function Ct(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Dt(v){e(f,t(f).filter((d,l)=>l!==v))}function Ot(){e(k,[...t(k),""])}function Ut(v){e(k,t(k).filter((d,l)=>l!==v))}async function It(){e(S,null);const{username:v,token:d}=J(D);if(!v||!d){e(S,"Not authenticated");return}const l={name:t(F),hometown:t(H),skater_type:t(j),stance:t(O),status:t(U),sponsors:t(_),contest_results:t(f),image:ct,imageSmall:ut,social_urls:t(k)};try{const p=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${d}`},body:JSON.stringify(l)}),o=await p.json();if(!p.ok)throw new Error(o.detail||"Save failed");it("/")}catch(p){console.error(p),e(S,p.message)}}Zt();var gt=Yt(),$t=ot(gt);{var Ft=v=>{var d=ee();y(v,d)},Ht=v=>{var d=ie(),l=ot(d);{var p=s=>{var r=ae(),c=n(r,!0);i(r),$(()=>wt(c,t(S))),y(s,r)};E(l,s=>{t(S)&&s(p)})}var o=a(l,2),q=a(n(o),2),x=n(q),A=a(x,2),Mt=a(A,2);{var Nt=s=>{var r=se(),c=ot(r),u=a(c,2),g=n(u);i(u),$(()=>{Vt(c,t(M)),wt(g,`Uploading… ${t(M)??""}%`)}),y(s,r)};E(Mt,s=>{t(I)&&s(Nt)})}i(q);var Y=a(q,2),B=n(Y),dt=a(n(B),2);b(dt),i(B);var K=a(B,2),mt=a(n(K),2);b(mt),i(K);var Q=a(K,2),V=n(Q),N=n(V);b(N),N.value=N.__value="skateboarder",lt(),i(V);var ft=a(V,2),z=n(ft);b(z),z.value=z.__value="roller skater",lt(),i(ft),i(Q);var _t=a(Q,2);{var zt=s=>{var r=oe(),c=a(n(r),2);$(()=>{t(O),C(()=>{})});var u=n(c);u.value=u.__value="regular";var g=a(u);g.value=g.__value="goofy",i(c),i(r),Tt(c,()=>t(O),h=>e(O,h)),y(s,r)};E(_t,s=>{t(j).includes("skateboarder")&&s(zt)})}var W=a(_t,2),Z=a(n(W),2);$(()=>{t(U),C(()=>{})});var tt=n(Z);tt.value=tt.__value="amateur";var kt=a(tt);kt.value=kt.__value="pro",i(Z),i(W);var et=a(W,2),bt=a(n(et),2);rt(bt,1,()=>t(k),nt,(s,r,c)=>{var u=le(),g=n(u);b(g);var h=a(g,2);i(u),R(g,()=>t(k)[c],L=>St(k,t(k)[c]=L)),w("click",h,()=>Ut(c)),y(s,u)});var Et=a(bt,2);i(et);var at=a(et,2),xt=a(n(at),2);rt(xt,1,()=>t(_),nt,(s,r,c)=>{var u=re(),g=n(u);b(g);var h=a(g,2);i(u),R(g,()=>t(_)[c],L=>St(_,t(_)[c]=L)),w("click",h,()=>qt(c)),y(s,u)});var Jt=a(xt,2);i(at);var ht=a(at,2),yt=a(n(ht),2);rt(yt,1,()=>t(f),nt,(s,r,c)=>{var u=ne(),g=n(u);b(g);var h=a(g,2);b(h);var L=a(h,2);b(L);var st=a(L,2);b(st);var Gt=a(st,2);i(u),R(g,()=>t(r).name,P=>(t(r).name=P,C(()=>t(f)))),R(h,()=>t(r).division,P=>(t(r).division=P,C(()=>t(f)))),R(L,()=>t(r).date,P=>(t(r).date=P,C(()=>t(f)))),R(st,()=>t(r).placement,P=>(t(r).placement=P,C(()=>t(f)))),w("click",Gt,()=>Dt(c)),y(s,u)});var Xt=a(yt,2);i(ht),lt(2),i(Y),i(o),$(()=>{Qt(x,"src",t(G)||"/default-avatar.png"),A.disabled=t(I)}),w("change",A,Lt),R(dt,()=>t(F),s=>e(F,s)),R(mt,()=>t(H),s=>e(H,s)),Rt(vt,[],N,()=>t(j),s=>e(j,s)),Rt(vt,[],z,()=>t(j),s=>e(j,s)),Tt(Z,()=>t(U),s=>e(U,s)),w("click",Et,Ot),w("click",Jt,Pt),w("click",Xt,Ct),w("submit",Y,Wt(It)),y(v,d)};E($t,v=>{t(pt)?v(Ft):v(Ht,!1)})}y(jt,gt),Kt()}export{we as component};
