import{c as Yt,a as y,t as j}from"../chunks/BQoy3Ge-.js";import"../chunks/B7M6h1YL.js";import{ak as Bt,aq as it,al as Kt,j as e,o as m,c as t,am as a,an as i,ao as n,ap as nt,ar as J,as as U,at as At}from"../chunks/DMDxMJuI.js";import{e as A,s as Rt}from"../chunks/Cu89BeFu.js";import{i as B}from"../chunks/Don0ab7i.js";import{e as ct,i as vt}from"../chunks/DvU_Ow3H.js";import{r as h,s as Qt,a as Vt}from"../chunks/BKRRD-CL.js";import{b as R,a as jt}from"../chunks/B_mvQ6aQ.js";import{b as Ct}from"../chunks/Bx2W0cYe.js";import{p as Wt}from"../chunks/CWmzcjye.js";import{i as Zt}from"../chunks/BPuRey6b.js";import{o as te}from"../chunks/3En_d9UL.js";import{g as z}from"../chunks/CVqalLBP.js";import{g as pt}from"../chunks/BfzroPM_.js";import{a as $}from"../chunks/C7CmiQTy.js";import{s as ut}from"../chunks/B609NVNN.js";var ee=j("<p>Loading profile…</p>"),ae=j('<div class="error-banner svelte-1gkgttx"> </div>'),se=j('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),oe=j('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),le=j('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),re=j('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=j('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ne=j('<!> <div class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Location</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></div>',1);function Ae(Lt,Ot){Bt(Ot,!1);const gt=[];let H=m(""),T="",q="",N=m(""),w=m([]),P=m("regular"),D=m("amateur"),k=m([]),f=m([]),b=m([]),E=m(null),I=m(!1),X=m(0),dt=m(!0),C=m(null);te(async()=>{const s=z(ut);e(H,s.name),e(N,s.hometown),e(w,[...s.skater_type]),e(P,s.stance||"regular"),e(D,s.status||"amateur"),e(k,[...s.sponsors||[]]),e(f,[...s.contest_results||[]]),e(b,[...s.social_urls||[]]),T=s.image,q=s.imageSmall,e(E,s.imageSmall);try{const{username:c,token:d}=z($);if(!c||!d){pt("/login");return}const _=await fetch(`/data/profiles/${c}.json`);if(_.ok){const l=await _.json();e(H,l.name),e(N,l.hometown),e(w,l.skater_type),e(P,l.stance||"regular"),e(D,l.status.toLowerCase()),e(k,l.sponsors||[]),e(f,l.contest_results||[]),e(b,l.social_urls||[]),T=l.image,q=l.imageSmall,e(E,l.imageSmall)}}catch(c){console.error("Failed to load profile JSON, using draft:",c)}finally{e(dt,!1)}});async function Tt(s){var M;const c=s.currentTarget;if(!((M=c.files)!=null&&M[0]))return;const d=c.files[0];e(E,URL.createObjectURL(d)),e(I,!0),e(X,0);const{token:_}=z($),l=new FormData;l.append("file",d),l.append("useDiffusion","false");const u=new XMLHttpRequest;u.open("POST","https://3ee.dev/account/upload/",!0),u.setRequestHeader("Accept","application/json"),u.setRequestHeader("Access-Control-Allow-Origin","https://skatebuild.pro"),u.setRequestHeader("Authorization",`Token ${_}`),u.upload.onprogress=x=>{x.lengthComputable&&e(X,Math.round(x.loaded/x.total*100))},u.onload=()=>{if(e(I,!1),u.status===401){$.set({}),pt("/login");return}if(u.status>=200&&u.status<300){const x=JSON.parse(u.responseText);T=x.image,q=x.imageSmall;const F={...z($)};F.profile={...F.profile,image:T,imageSmall:q},$.set(F),ut.update(K=>({...K,image:T,imageSmall:q}))}else console.error("Upload failed:",u.statusText),e(C,"Image upload failed")},u.onerror=()=>{e(I,!1),console.error("Upload XHR error"),e(C,"Image upload failed")},u.send(l)}function qt(){e(k,[...t(k),""])}function Pt(s){e(k,t(k).filter((c,d)=>d!==s))}function Dt(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Ut(s){e(f,t(f).filter((c,d)=>d!==s))}function $t(){e(b,[...t(b),""])}function Ht(s){e(b,t(b).filter((c,d)=>d!==s))}async function Nt(){e(C,null);const{username:s,token:c}=z($);if(!s||!c){e(C,"Not authenticated");return}const d={name:t(H),hometown:t(N),skater_type:t(w),stance:t(P),status:t(D),sponsors:t(k),contest_results:t(f),image:T,imageSmall:q,social_urls:t(b)};try{const _=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{Accept:"application/json","Access-Control-Allow-Origin":"https://skatebuild.pro","Content-Type":"application/json",Authorization:`Token ${c}`},mode:"cors",body:JSON.stringify(d)}),l=await _.json();if(ut.set(l),!_.ok)throw new Error(l.detail||"Save failed");await pt(`/profiles/${s}`)}catch(_){console.error(_),e(C,_.message)}}Zt();var mt=Yt(),It=it(mt);{var Mt=s=>{var c=ee();y(s,c)},Ft=s=>{var c=ne(),d=it(c);{var _=o=>{var r=ae(),v=i(r,!0);n(r),J(()=>Rt(v,t(C))),y(o,r)};B(d,o=>{t(C)&&o(_)})}var l=a(d,2),u=a(i(l),2),M=i(u),x=a(M,2),F=a(x,2);{var K=o=>{var r=se(),v=it(r),p=a(v,2),g=i(p);n(p),J(()=>{Vt(v,t(X)),Rt(g,`Uploading… ${t(X)??""}%`)}),y(o,r)};B(F,o=>{t(I)&&o(K)})}n(u);var Q=a(u,2),V=i(Q),ft=a(i(V),2);h(ft),n(V);var W=a(V,2),_t=a(i(W),2);h(_t),n(W);var Z=a(W,2),tt=i(Z),G=i(tt);h(G),G.value=G.__value="skateboarder",nt(),n(tt);var kt=a(tt,2),Y=i(kt);h(Y),Y.value=Y.__value="roller skater",nt(),n(kt),n(Z);var bt=a(Z,2);{var Jt=o=>{var r=oe(),v=a(i(r),2);J(()=>{t(P),U(()=>{})});var p=i(v);p.value=p.__value="regular";var g=a(p);g.value=g.__value="goofy",n(v),n(r),Ct(v,()=>t(P),S=>e(P,S)),y(o,r)};B(bt,o=>{t(w).includes("skateboarder")&&o(Jt)})}var et=a(bt,2),at=a(i(et),2);J(()=>{t(D),U(()=>{})});var st=i(at);st.value=st.__value="amateur";var xt=a(st);xt.value=xt.__value="pro",n(at),n(et);var ot=a(et,2),ht=a(i(ot),2);ct(ht,1,()=>t(b),vt,(o,r,v)=>{var p=le(),g=i(p);h(g);var S=a(g,2);n(p),R(g,()=>t(b)[v],L=>At(b,t(b)[v]=L)),A("click",S,()=>Ht(v)),y(o,p)});var zt=a(ht,2);n(ot);var lt=a(ot,2),St=a(i(lt),2);ct(St,1,()=>t(k),vt,(o,r,v)=>{var p=re(),g=i(p);h(g);var S=a(g,2);n(p),R(g,()=>t(k)[v],L=>At(k,t(k)[v]=L)),A("click",S,()=>Pt(v)),y(o,p)});var Et=a(St,2);n(lt);var yt=a(lt,2),wt=a(i(yt),2);ct(wt,1,()=>t(f),vt,(o,r,v)=>{var p=ie(),g=i(p);h(g);var S=a(g,2);h(S);var L=a(S,2);h(L);var rt=a(L,2);h(rt);var Gt=a(rt,2);n(p),R(g,()=>t(r).name,O=>(t(r).name=O,U(()=>t(f)))),R(S,()=>t(r).division,O=>(t(r).division=O,U(()=>t(f)))),R(L,()=>t(r).date,O=>(t(r).date=O,U(()=>t(f)))),R(rt,()=>t(r).placement,O=>(t(r).placement=O,U(()=>t(f)))),A("click",Gt,()=>Ut(v)),y(o,p)});var Xt=a(wt,2);n(yt),nt(2),n(Q),n(l),J(()=>{Qt(M,"src",t(E)||"/default-avatar.png"),x.disabled=t(I)}),A("change",x,Tt),R(ft,()=>t(H),o=>e(H,o)),R(_t,()=>t(N),o=>e(N,o)),jt(gt,[],G,()=>t(w),o=>e(w,o)),jt(gt,[],Y,()=>t(w),o=>e(w,o)),Ct(at,()=>t(D),o=>e(D,o)),A("click",zt,$t),A("click",Et,qt),A("click",Xt,Dt),A("submit",Q,Wt(Nt)),y(s,c)};B(It,s=>{t(dt)?s(Mt):s(Ft,!1)})}y(Lt,mt),Kt()}export{Ae as component};
