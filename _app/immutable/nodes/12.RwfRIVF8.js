import{c as Yt,a as y,t as R}from"../chunks/Cbs2TP5J.js";import"../chunks/DppSS1ZK.js";import{ak as Bt,aq as ot,al as Kt,j as e,o as m,c as t,am as a,an as n,ao as i,ap as lt,ar as I,as as L,at as St}from"../chunks/BQECxIka.js";import{e as w,s as wt}from"../chunks/D7dhJHJ5.js";import{i as E}from"../chunks/BxIlQOsl.js";import{e as rt,i as nt}from"../chunks/_x8JZXJS.js";import{r as b,s as Qt,a as Vt}from"../chunks/C1JmazWi.js";import{b as A,a as At}from"../chunks/BHVgj7FX.js";import{b as Rt}from"../chunks/CoqOecze.js";import{p as Wt}from"../chunks/CWmzcjye.js";import{i as Zt}from"../chunks/-1FsuQLY.js";import{o as te}from"../chunks/BNi7mzQR.js";import{g as J}from"../chunks/CufRIGZF.js";import{g as it}from"../chunks/BSGixbzC.js";import{a as P}from"../chunks/BMexqwi4.js";var ee=R("<p>Loading profile…</p>"),ae=R('<div class="error-banner svelte-1gkgttx"> </div>'),se=R('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),oe=R('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),le=R('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),re=R('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ne=R('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=R('<!> <main class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Hometown</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></main>',1);function we(jt,Tt){Bt(Tt,!1);const vt=[];let $=m(""),ct="",pt="",F=m(""),j=m([]),D=m("regular"),H=m("Amateur"),_=m([]),f=m([]),k=m([]),M=m(0),X=null,G=m(null),U=m(!1),ut=m(!0),S=m(null);te(async()=>{const{username:v,token:d,profile:l}=J(P);if(!v||!d){it("/login");return}e(G,(l==null?void 0:l.imageSmall)||null),ct=(l==null?void 0:l.image)||"",pt=(l==null?void 0:l.imageSmall)||"";try{const u=await fetch(`/data/profiles/${v}.json`);if(u.ok){const s=await u.json();e($,s.name),e(F,s.hometown),e(j,s.skater_type),e(D,s.stance||"regular"),e(H,s.status),e(_,s.sponsors||[]),e(f,s.contest_results||[]),e(k,s.social_urls||[])}}catch(u){console.error(u),e(S,"Failed to load profile.")}finally{e(ut,!1)}});async function qt(v){var O;const d=v.currentTarget;if(!((O=d.files)!=null&&O.length))return;X=d.files[0],e(G,URL.createObjectURL(X)),e(U,!0),e(M,0);const{token:l}=J(P),u=new FormData;u.append("file",X),u.append("useDiffusion","false");const s=new XMLHttpRequest;s.open("POST","https://3ee.dev/account/upload/",!0),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Access-Control-Allow-Origin","https://skatebuild.pro"),s.setRequestHeader("Authorization",`Token ${l}`),s.upload.onprogress=x=>{x.lengthComputable&&e(M,Math.round(x.loaded/x.total*100))},s.onload=()=>{if(e(U,!1),s.status===401){P.set({}),it("/login");return}if(s.status>=200&&s.status<300){const x=JSON.parse(s.responseText),T={...J(P)};T.profile={...T.profile,image:x.image,imageSmall:x.imageSmall},P.set(T)}else console.error("Upload failed",s.statusText),e(S,"Image upload failed")},s.onerror=()=>{e(U,!1),console.error("XHR error"),e(S,"Image upload failed")},s.send(u)}function Ct(){e(_,[...t(_),""])}function Ot(v){e(_,t(_).filter((d,l)=>l!==v))}function Lt(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Pt(v){e(f,t(f).filter((d,l)=>l!==v))}function Dt(){e(k,[...t(k),""])}function Ht(v){e(k,t(k).filter((d,l)=>l!==v))}async function Ut(){e(S,null);const{username:v,token:d}=J(P);if(!v||!d){e(S,"Not authenticated");return}const l={name:t($),hometown:t(F),skater_type:t(j),stance:t(D),status:t(H),sponsors:t(_),contest_results:t(f),image:ct,imageSmall:pt,social_urls:t(k)};try{const u=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{Accept:"application/json","Access-Control-Allow-Origin":"https://skatebuild.pro","Content-Type":"application/json",Authorization:`Token ${d}`},mode:"cors",body:JSON.stringify(l)}),s=await u.json();if(!u.ok)throw new Error(s.detail||"Save failed");it("/")}catch(u){console.error(u),e(S,u.message)}}Zt();var gt=Yt(),It=ot(gt);{var $t=v=>{var d=ee();y(v,d)},Ft=v=>{var d=ie(),l=ot(d);{var u=o=>{var r=ae(),c=n(r,!0);i(r),I(()=>wt(c,t(S))),y(o,r)};E(l,o=>{t(S)&&o(u)})}var s=a(l,2),O=a(n(s),2),x=n(O),T=a(x,2),Mt=a(T,2);{var Nt=o=>{var r=se(),c=ot(r),p=a(c,2),g=n(p);i(p),I(()=>{Vt(c,t(M)),wt(g,`Uploading… ${t(M)??""}%`)}),y(o,r)};E(Mt,o=>{t(U)&&o(Nt)})}i(O);var Y=a(O,2),B=n(Y),dt=a(n(B),2);b(dt),i(B);var K=a(B,2),mt=a(n(K),2);b(mt),i(K);var Q=a(K,2),V=n(Q),N=n(V);b(N),N.value=N.__value="skateboarder",lt(),i(V);var ft=a(V,2),z=n(ft);b(z),z.value=z.__value="roller skater",lt(),i(ft),i(Q);var _t=a(Q,2);{var zt=o=>{var r=oe(),c=a(n(r),2);I(()=>{t(D),L(()=>{})});var p=n(c);p.value=p.__value="regular";var g=a(p);g.value=g.__value="goofy",i(c),i(r),Rt(c,()=>t(D),h=>e(D,h)),y(o,r)};E(_t,o=>{t(j).includes("skateboarder")&&o(zt)})}var W=a(_t,2),Z=a(n(W),2);I(()=>{t(H),L(()=>{})});var tt=n(Z);tt.value=tt.__value="amateur";var kt=a(tt);kt.value=kt.__value="pro",i(Z),i(W);var et=a(W,2),bt=a(n(et),2);rt(bt,1,()=>t(k),nt,(o,r,c)=>{var p=le(),g=n(p);b(g);var h=a(g,2);i(p),A(g,()=>t(k)[c],q=>St(k,t(k)[c]=q)),w("click",h,()=>Ht(c)),y(o,p)});var Et=a(bt,2);i(et);var at=a(et,2),xt=a(n(at),2);rt(xt,1,()=>t(_),nt,(o,r,c)=>{var p=re(),g=n(p);b(g);var h=a(g,2);i(p),A(g,()=>t(_)[c],q=>St(_,t(_)[c]=q)),w("click",h,()=>Ot(c)),y(o,p)});var Jt=a(xt,2);i(at);var ht=a(at,2),yt=a(n(ht),2);rt(yt,1,()=>t(f),nt,(o,r,c)=>{var p=ne(),g=n(p);b(g);var h=a(g,2);b(h);var q=a(h,2);b(q);var st=a(q,2);b(st);var Gt=a(st,2);i(p),A(g,()=>t(r).name,C=>(t(r).name=C,L(()=>t(f)))),A(h,()=>t(r).division,C=>(t(r).division=C,L(()=>t(f)))),A(q,()=>t(r).date,C=>(t(r).date=C,L(()=>t(f)))),A(st,()=>t(r).placement,C=>(t(r).placement=C,L(()=>t(f)))),w("click",Gt,()=>Pt(c)),y(o,p)});var Xt=a(yt,2);i(ht),lt(2),i(Y),i(s),I(()=>{Qt(x,"src",t(G)||"/default-avatar.png"),T.disabled=t(U)}),w("change",T,qt),A(dt,()=>t($),o=>e($,o)),A(mt,()=>t(F),o=>e(F,o)),At(vt,[],N,()=>t(j),o=>e(j,o)),At(vt,[],z,()=>t(j),o=>e(j,o)),Rt(Z,()=>t(H),o=>e(H,o)),w("click",Et,Dt),w("click",Jt,Ct),w("click",Xt,Lt),w("submit",Y,Wt(Ut)),y(v,d)};E(It,v=>{t(ut)?v($t):v(Ft,!1)})}y(jt,gt),Kt()}export{we as component};
