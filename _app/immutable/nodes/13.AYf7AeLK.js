import{c as Yt,a as y,t as j}from"../chunks/Dyx7IcD8.js";import"../chunks/DCFqVp-V.js";import{al as Bt,aq as it,am as Kt,j as e,o as m,c as t,an as a,ao as i,ap as n,ak as nt,ar as J,as as U,at as At}from"../chunks/CqSBzqQc.js";import{e as A,s as Rt}from"../chunks/BrymZGSQ.js";import{i as B}from"../chunks/C2mwve1f.js";import{e as vt,i as ct}from"../chunks/CnzoR5j3.js";import{r as h,s as Qt,a as Vt}from"../chunks/dkLHxQIu.js";import{b as R,a as jt}from"../chunks/BxjodTjc.js";import{b as Ct}from"../chunks/RIHeN50M.js";import{p as Wt}from"../chunks/CWmzcjye.js";import{i as Zt}from"../chunks/Gey7JNpV.js";import{o as te}from"../chunks/CeeXpUfi.js";import{g as z}from"../chunks/B-PIdrVz.js";import{g as pt}from"../chunks/ecQM-7zy.js";import{a as H}from"../chunks/ChUaDgMI.js";import{s as ut}from"../chunks/C5APYiYC.js";var ee=j("<p>Loading profile…</p>"),ae=j('<div class="error-banner svelte-1gkgttx"> </div>'),se=j('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),oe=j('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),le=j('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),re=j('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=j('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ne=j('<!> <div class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Hometown</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></div>',1);function Ae(Ot,Tt){Bt(Tt,!1);const gt=[];let $=m(""),q="",L="",N=m(""),w=m([]),P=m("regular"),D=m("amateur"),k=m([]),f=m([]),b=m([]),E=m(null),I=m(!1),X=m(0),dt=m(!0),C=m(null);te(async()=>{const s=z(ut);e($,s.name),e(N,s.hometown),e(w,[...s.skater_type]),e(P,s.stance||"regular"),e(D,s.status||"amateur"),e(k,[...s.sponsors||[]]),e(f,[...s.contest_results||[]]),e(b,[...s.social_urls||[]]),q=s.image,L=s.imageSmall,e(E,s.imageSmall);try{const{username:v,token:d}=z(H);if(!v||!d){pt("/login");return}const _=await fetch(`/data/profiles/${v}.json`);if(_.ok){const l=await _.json();e($,l.name),e(N,l.hometown),e(w,l.skater_type),e(P,l.stance||"regular"),e(D,l.status.toLowerCase()),e(k,l.sponsors||[]),e(f,l.contest_results||[]),e(b,l.social_urls||[]),q=l.image,L=l.imageSmall,e(E,l.imageSmall)}}catch(v){console.error("Failed to load profile JSON, using draft:",v)}finally{e(dt,!1)}});async function qt(s){var M;const v=s.currentTarget;if(!((M=v.files)!=null&&M[0]))return;const d=v.files[0];e(E,URL.createObjectURL(d)),e(I,!0),e(X,0);const{token:_}=z(H),l=new FormData;l.append("file",d),l.append("useDiffusion","false");const u=new XMLHttpRequest;u.open("POST","https://3ee.dev/account/upload/",!0),u.setRequestHeader("Accept","application/json"),u.setRequestHeader("Access-Control-Allow-Origin","https://skatebuild.pro"),u.setRequestHeader("Authorization",`Token ${_}`),u.upload.onprogress=x=>{x.lengthComputable&&e(X,Math.round(x.loaded/x.total*100))},u.onload=()=>{if(e(I,!1),u.status===401){H.set({}),pt("/login");return}if(u.status>=200&&u.status<300){const x=JSON.parse(u.responseText);q=x.image,L=x.imageSmall;const F={...z(H)};F.profile={...F.profile,image:q,imageSmall:L},H.set(F),ut.update(K=>({...K,image:q,imageSmall:L}))}else console.error("Upload failed:",u.statusText),e(C,"Image upload failed")},u.onerror=()=>{e(I,!1),console.error("Upload XHR error"),e(C,"Image upload failed")},u.send(l)}function Lt(){e(k,[...t(k),""])}function Pt(s){e(k,t(k).filter((v,d)=>d!==s))}function Dt(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Ut(s){e(f,t(f).filter((v,d)=>d!==s))}function Ht(){e(b,[...t(b),""])}function $t(s){e(b,t(b).filter((v,d)=>d!==s))}async function Nt(){e(C,null);const{username:s,token:v}=z(H);if(!s||!v){e(C,"Not authenticated");return}const d={name:t($),hometown:t(N),skater_type:t(w),stance:t(P),status:t(D),sponsors:t(k),contest_results:t(f),image:q,imageSmall:L,social_urls:t(b)};try{const _=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{Accept:"application/json","Access-Control-Allow-Origin":"https://skatebuild.pro","Content-Type":"application/json",Authorization:`Token ${v}`},mode:"cors",body:JSON.stringify(d)}),l=await _.json();if(ut.set(l),!_.ok)throw new Error(l.detail||"Save failed");await pt(`/profiles/${s}`)}catch(_){console.error(_),e(C,_.message)}}Zt();var mt=Yt(),It=it(mt);{var Mt=s=>{var v=ee();y(s,v)},Ft=s=>{var v=ne(),d=it(v);{var _=o=>{var r=ae(),c=i(r,!0);n(r),J(()=>Rt(c,t(C))),y(o,r)};B(d,o=>{t(C)&&o(_)})}var l=a(d,2),u=a(i(l),2),M=i(u),x=a(M,2),F=a(x,2);{var K=o=>{var r=se(),c=it(r),p=a(c,2),g=i(p);n(p),J(()=>{Vt(c,t(X)),Rt(g,`Uploading… ${t(X)??""}%`)}),y(o,r)};B(F,o=>{t(I)&&o(K)})}n(u);var Q=a(u,2),V=i(Q),ft=a(i(V),2);h(ft),n(V);var W=a(V,2),_t=a(i(W),2);h(_t),n(W);var Z=a(W,2),tt=i(Z),G=i(tt);h(G),G.value=G.__value="skateboarder",nt(),n(tt);var kt=a(tt,2),Y=i(kt);h(Y),Y.value=Y.__value="roller skater",nt(),n(kt),n(Z);var bt=a(Z,2);{var Jt=o=>{var r=oe(),c=a(i(r),2);J(()=>{t(P),U(()=>{})});var p=i(c);p.value=p.__value="regular";var g=a(p);g.value=g.__value="goofy",n(c),n(r),Ct(c,()=>t(P),S=>e(P,S)),y(o,r)};B(bt,o=>{t(w).includes("skateboarder")&&o(Jt)})}var et=a(bt,2),at=a(i(et),2);J(()=>{t(D),U(()=>{})});var st=i(at);st.value=st.__value="amateur";var xt=a(st);xt.value=xt.__value="pro",n(at),n(et);var ot=a(et,2),ht=a(i(ot),2);vt(ht,1,()=>t(b),ct,(o,r,c)=>{var p=le(),g=i(p);h(g);var S=a(g,2);n(p),R(g,()=>t(b)[c],O=>At(b,t(b)[c]=O)),A("click",S,()=>$t(c)),y(o,p)});var zt=a(ht,2);n(ot);var lt=a(ot,2),St=a(i(lt),2);vt(St,1,()=>t(k),ct,(o,r,c)=>{var p=re(),g=i(p);h(g);var S=a(g,2);n(p),R(g,()=>t(k)[c],O=>At(k,t(k)[c]=O)),A("click",S,()=>Pt(c)),y(o,p)});var Et=a(St,2);n(lt);var yt=a(lt,2),wt=a(i(yt),2);vt(wt,1,()=>t(f),ct,(o,r,c)=>{var p=ie(),g=i(p);h(g);var S=a(g,2);h(S);var O=a(S,2);h(O);var rt=a(O,2);h(rt);var Gt=a(rt,2);n(p),R(g,()=>t(r).name,T=>(t(r).name=T,U(()=>t(f)))),R(S,()=>t(r).division,T=>(t(r).division=T,U(()=>t(f)))),R(O,()=>t(r).date,T=>(t(r).date=T,U(()=>t(f)))),R(rt,()=>t(r).placement,T=>(t(r).placement=T,U(()=>t(f)))),A("click",Gt,()=>Ut(c)),y(o,p)});var Xt=a(wt,2);n(yt),nt(2),n(Q),n(l),J(()=>{Qt(M,"src",t(E)||"/default-avatar.png"),x.disabled=t(I)}),A("change",x,qt),R(ft,()=>t($),o=>e($,o)),R(_t,()=>t(N),o=>e(N,o)),jt(gt,[],G,()=>t(w),o=>e(w,o)),jt(gt,[],Y,()=>t(w),o=>e(w,o)),Ct(at,()=>t(D),o=>e(D,o)),A("click",zt,Ht),A("click",Et,Lt),A("click",Xt,Dt),A("submit",Q,Wt(Nt)),y(s,v)};B(It,s=>{t(dt)?s(Mt):s(Ft,!1)})}y(Ot,mt),Kt()}export{Ae as component};
