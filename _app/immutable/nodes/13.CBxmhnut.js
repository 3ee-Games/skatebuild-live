import{c as Yt,a as y,t as j}from"../chunks/Cbs2TP5J.js";import"../chunks/DppSS1ZK.js";import{ak as Bt,aq as rt,al as Kt,j as e,o as m,c as t,am as s,an as n,ao as i,ap as nt,ar as J,as as P,at as yt}from"../chunks/BQECxIka.js";import{e as A,s as wt}from"../chunks/D7dhJHJ5.js";import{i as B}from"../chunks/BxIlQOsl.js";import{e as it,i as ct}from"../chunks/_x8JZXJS.js";import{r as x,s as Qt,a as Vt}from"../chunks/C1JmazWi.js";import{b as R,a as At}from"../chunks/BHVgj7FX.js";import{b as Rt}from"../chunks/CoqOecze.js";import{p as Wt}from"../chunks/CWmzcjye.js";import{i as Zt}from"../chunks/-1FsuQLY.js";import{o as te}from"../chunks/BNi7mzQR.js";import{g as z}from"../chunks/CufRIGZF.js";import{g as vt}from"../chunks/VDuJxPtT.js";import{a as D}from"../chunks/BMexqwi4.js";import{s as jt}from"../chunks/U1qOr88d.js";var ee=j("<p>Loading profile…</p>"),ae=j('<div class="error-banner svelte-1gkgttx"> </div>'),se=j('<progress class="progress-bar svelte-1gkgttx" max="100"></progress> <p> </p>',1),oe=j('<div class="field svelte-1gkgttx"><label for="stance" class="svelte-1gkgttx">Stance</label> <select id="stance" class="svelte-1gkgttx"><option>Regular</option><option>Goofy</option></select></div>'),le=j('<div class="list-row svelte-1gkgttx"><input type="url" placeholder="https://" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),re=j('<div class="list-row svelte-1gkgttx"><input placeholder="Sponsor name" required class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ne=j('<div class="list-row svelte-1gkgttx"><input placeholder="Contest name" required class="svelte-1gkgttx"> <input placeholder="Division" class="svelte-1gkgttx"> <input type="date" class="svelte-1gkgttx"> <input type="number" min="1" class="svelte-1gkgttx"> <button type="button">✕</button></div>'),ie=j('<!> <main class="container svelte-1gkgttx"><h1 class="svelte-1gkgttx">Edit Your Profile</h1> <div class="avatar-section svelte-1gkgttx"><img alt="Avatar preview" class="avatar-img svelte-1gkgttx"> <input type="file" accept="image/*" class="svelte-1gkgttx"> <!></div> <form><div class="field svelte-1gkgttx"><label for="name" class="svelte-1gkgttx">Name</label> <input id="name" required class="svelte-1gkgttx"></div> <div class="field svelte-1gkgttx"><label for="hometown" class="svelte-1gkgttx">Hometown</label> <input id="hometown" class="svelte-1gkgttx"></div> <div class="field-group svelte-1gkgttx"><label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Skateboarder</label> <label class="svelte-1gkgttx"><input type="checkbox" class="svelte-1gkgttx"> Roller Skater</label></div> <!> <div class="field svelte-1gkgttx"><label for="status" class="svelte-1gkgttx">Skill Level</label> <select id="status" class="svelte-1gkgttx"><option>Amateur</option><option>Pro</option></select></div> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Social</h2> <!> <button type="button">+ Add Social Link</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Sponsors</h2> <!> <button type="button">+ Add Sponsor</button></section> <section class="svelte-1gkgttx"><h2 class="svelte-1gkgttx">Contest Results</h2> <!> <button type="button">+ Add Result</button></section> <button type="submit"><span>Save Profile</span></button></form></main>',1);function Ae(Ct,Ot){Bt(Ot,!1);const pt=[];let U=m(""),H="",$="",N=m(""),w=m([]),q=m("regular"),L=m("amateur"),_=m([]),f=m([]),k=m([]),E=m(null),I=m(!1),X=m(0),ut=m(!0),C=m(null);te(async()=>{{const a=z(jt);e(U,a.name),e(N,a.hometown),e(w,[...a.skater_type]),e(q,a.stance||"regular"),e(L,a.status||"amateur"),e(_,[...a.sponsors||[]]),e(f,[...a.contest_results||[]]),e(k,[...a.social_urls||[]]),H=a.image,$=a.imageSmall,e(E,a.imageSmall)}try{const{username:a,token:d}=z(D);if(!a||!d){vt("/login");return}const u=await fetch(`/data/profiles/${a}.json`);if(u.ok){const l=await u.json();e(U,l.name),e(N,l.hometown),e(w,l.skater_type),e(q,l.stance||"regular"),e(L,l.status.toLowerCase()),e(_,l.sponsors||[]),e(f,l.contest_results||[]),e(k,l.social_urls||[]),H=l.image,$=l.imageSmall,e(E,l.imageSmall)}}catch(a){console.error("Failed to load profile JSON, using draft:",a)}finally{e(ut,!1)}});async function Tt(a){var M;const d=a.currentTarget;if(!((M=d.files)!=null&&M[0]))return;const u=d.files[0];e(E,URL.createObjectURL(u)),e(I,!0),e(X,0);const{token:l}=z(D),h=new FormData;h.append("file",u),h.append("useDiffusion","false");const p=new XMLHttpRequest;p.open("POST","https://3ee.dev/account/upload/",!0),p.setRequestHeader("Accept","application/json"),p.setRequestHeader("Access-Control-Allow-Origin","https://skatebuild.pro"),p.setRequestHeader("Authorization",`Token ${l}`),p.upload.onprogress=b=>{b.lengthComputable&&e(X,Math.round(b.loaded/b.total*100))},p.onload=()=>{if(e(I,!1),p.status===401){D.set({}),vt("/login");return}if(p.status>=200&&p.status<300){const b=JSON.parse(p.responseText);H=b.image,$=b.imageSmall;const F={...z(D)};F.profile={...F.profile,image:H,imageSmall:$},D.set(F)}else console.error("Upload failed:",p.statusText),e(C,"Image upload failed")},p.onerror=()=>{e(I,!1),console.error("Upload XHR error"),e(C,"Image upload failed")},p.send(h)}function qt(){e(_,[...t(_),""])}function Lt(a){e(_,t(_).filter((d,u)=>u!==a))}function Pt(){e(f,[...t(f),{name:"",division:"",date:new Date().toISOString().slice(0,10),placement:1}])}function Dt(a){e(f,t(f).filter((d,u)=>u!==a))}function Ut(){e(k,[...t(k),""])}function Ht(a){e(k,t(k).filter((d,u)=>u!==a))}async function $t(){e(C,null);const{username:a,token:d}=z(D);if(!a||!d){e(C,"Not authenticated");return}const u={name:t(U),hometown:t(N),skater_type:t(w),stance:t(q),status:t(L),sponsors:t(_),contest_results:t(f),image:H,imageSmall:$,social_urls:t(k)};try{const l=await fetch("https://3ee.dev/skatebuild/api/profiles/save/",{method:"POST",headers:{Accept:"application/json","Access-Control-Allow-Origin":"https://skatebuild.pro","Content-Type":"application/json",Authorization:`Token ${d}`},mode:"cors",body:JSON.stringify(u)}),h=await l.json();if(jt.set(h),!l.ok)throw new Error(h.detail||"Save failed");await vt(`/profiles/${a}`)}catch(l){console.error(l),e(C,l.message)}}Zt();var gt=Yt(),Nt=rt(gt);{var It=a=>{var d=ee();y(a,d)},Mt=a=>{var d=ie(),u=rt(d);{var l=o=>{var r=ae(),c=n(r,!0);i(r),J(()=>wt(c,t(C))),y(o,r)};B(u,o=>{t(C)&&o(l)})}var h=s(u,2),p=s(n(h),2),M=n(p),b=s(M,2),F=s(b,2);{var Ft=o=>{var r=se(),c=rt(r),v=s(c,2),g=n(v);i(v),J(()=>{Vt(c,t(X)),wt(g,`Uploading… ${t(X)??""}%`)}),y(o,r)};B(F,o=>{t(I)&&o(Ft)})}i(p);var K=s(p,2),Q=n(K),dt=s(n(Q),2);x(dt),i(Q);var V=s(Q,2),mt=s(n(V),2);x(mt),i(V);var W=s(V,2),Z=n(W),G=n(Z);x(G),G.value=G.__value="skateboarder",nt(),i(Z);var ft=s(Z,2),Y=n(ft);x(Y),Y.value=Y.__value="roller skater",nt(),i(ft),i(W);var _t=s(W,2);{var Jt=o=>{var r=oe(),c=s(n(r),2);J(()=>{t(q),P(()=>{})});var v=n(c);v.value=v.__value="regular";var g=s(v);g.value=g.__value="goofy",i(c),i(r),Rt(c,()=>t(q),S=>e(q,S)),y(o,r)};B(_t,o=>{t(w).includes("skateboarder")&&o(Jt)})}var tt=s(_t,2),et=s(n(tt),2);J(()=>{t(L),P(()=>{})});var at=n(et);at.value=at.__value="amateur";var kt=s(at);kt.value=kt.__value="pro",i(et),i(tt);var st=s(tt,2),bt=s(n(st),2);it(bt,1,()=>t(k),ct,(o,r,c)=>{var v=le(),g=n(v);x(g);var S=s(g,2);i(v),R(g,()=>t(k)[c],O=>yt(k,t(k)[c]=O)),A("click",S,()=>Ht(c)),y(o,v)});var zt=s(bt,2);i(st);var ot=s(st,2),xt=s(n(ot),2);it(xt,1,()=>t(_),ct,(o,r,c)=>{var v=re(),g=n(v);x(g);var S=s(g,2);i(v),R(g,()=>t(_)[c],O=>yt(_,t(_)[c]=O)),A("click",S,()=>Lt(c)),y(o,v)});var Et=s(xt,2);i(ot);var ht=s(ot,2),St=s(n(ht),2);it(St,1,()=>t(f),ct,(o,r,c)=>{var v=ne(),g=n(v);x(g);var S=s(g,2);x(S);var O=s(S,2);x(O);var lt=s(O,2);x(lt);var Gt=s(lt,2);i(v),R(g,()=>t(r).name,T=>(t(r).name=T,P(()=>t(f)))),R(S,()=>t(r).division,T=>(t(r).division=T,P(()=>t(f)))),R(O,()=>t(r).date,T=>(t(r).date=T,P(()=>t(f)))),R(lt,()=>t(r).placement,T=>(t(r).placement=T,P(()=>t(f)))),A("click",Gt,()=>Dt(c)),y(o,v)});var Xt=s(St,2);i(ht),nt(2),i(K),i(h),J(()=>{Qt(M,"src",t(E)||"/default-avatar.png"),b.disabled=t(I)}),A("change",b,Tt),R(dt,()=>t(U),o=>e(U,o)),R(mt,()=>t(N),o=>e(N,o)),At(pt,[],G,()=>t(w),o=>e(w,o)),At(pt,[],Y,()=>t(w),o=>e(w,o)),Rt(et,()=>t(L),o=>e(L,o)),A("click",zt,Ut),A("click",Et,qt),A("click",Xt,Pt),A("submit",K,Wt($t)),y(a,d)};B(Nt,a=>{t(ut)?a(It):a(Mt,!1)})}y(Ct,gt),Kt()}export{Ae as component};
